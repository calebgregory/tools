#!/usr/bin/env bash
#MISE description="Full pipeline: split audio, transcribe chunks, stitch and reformat"
set -euo pipefail

in="${1:?usage: mise run audio:all <input.mp4> [workdir]}"
workdir="${2:-}"

if [[ -z "${workdir}" ]]; then
  base="$(basename "$in")"
  stem="${base%.*}"
  workdir="./.transcribe/${stem}"
fi

mise run audio:split:all -- "$in" "$workdir"
mise run audio:transcribe -- "$workdir"
mise run audio:stitch -- "$workdir"

cat <<EOM

Done.
Workdir: $workdir
  - chunks:      $workdir/chunks/
  - transcripts: $workdir/transcripts/
  - combined:    $workdir/transcript.jsonl
  - raw text:    $workdir/transcript.raw.txt
  - formatted:   $workdir/transcript.txt
EOM
